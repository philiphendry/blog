---
author: philiphendry
comments: true
date: 2011-02-21 13:38:32+00:00
layout: post
slug: grouping-multiple-consecutive-days-using-t-sql
title: Grouping Multiple Consecutive Days using T-sql
wordpress_id: 346
categories:
- T-SQL
---

I have a timesheet table that contains one entry per day per employee and against each entry is a reason flag which indicates whether the entry is for a holiday or sickness etc. I’ve written a SQL Server report that generates a list of the holidays that drills-down several levels to the actual holidays but I don’t want to list individual days but rather the holiday periods as a date from/to and numbers of days. With some inspirational thinking from [Rob Farley](http://stackoverflow.com/questions/1176011/sql-to-determine-minimum-sequential-days-of-access/1176255#1176255) I’ve created must the same query as his to merge the consecutive days and provide a total. Here’s the initial version :

 
    
    <span style="color:#0000FF;">set</span><span style="color:#000000;"> nocount </span><span style="color:#0000FF;">on</span><span style="color:#000000;">
    
    </span><span style="color:#0000FF;">declare</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">as</span><span style="color:#000000;"> </span><span style="color:#0000FF;">table</span><span style="color:#000000;"> (
        PayrollNumber </span><span style="color:#0000FF;">int</span><span style="color:#000000;"> </span><span style="color:#808080;">not</span><span style="color:#000000;"> </span><span style="color:#0000FF;">null</span><span style="color:#000000;">,
        DateFrom </span><span style="color:#0000FF;">datetime</span><span style="color:#000000;"> </span><span style="color:#808080;">not</span><span style="color:#000000;"> </span><span style="color:#0000FF;">null</span><span style="color:#000000;">,
        DateTo </span><span style="color:#0000FF;">datetime</span><span style="color:#000000;"> </span><span style="color:#808080;">not</span><span style="color:#000000;"> </span><span style="color:#0000FF;">null</span><span style="color:#000000;">,
        NoOfDays </span><span style="color:#0000FF;">int</span><span style="color:#000000;"> </span><span style="color:#808080;">not</span><span style="color:#000000;"> </span><span style="color:#0000FF;">null</span><span style="color:#000000;">
    )
    
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-08</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-08</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-09</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-09</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-10</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-10</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-11</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-11</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-12</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-12</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-18</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-18</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-19</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-19</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-05</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-05</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-06</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-06</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-07</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-07</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-06-10</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-10</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-06-11</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-11</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    
    </span><span style="color:#0000FF;">select</span><span style="color:#000000;"> 
        PayrollNumber, 
        </span><span style="color:#FF00FF;">min</span><span style="color:#000000;">(DateFrom) </span><span style="color:#0000FF;">as</span><span style="color:#000000;"> DateFrom, 
        </span><span style="color:#FF00FF;">max</span><span style="color:#000000;">(DateTo) </span><span style="color:#0000FF;">as</span><span style="color:#000000;"> DateTo, 
        </span><span style="color:#FF00FF;">sum</span><span style="color:#000000;">(NoOfDays) </span><span style="color:#0000FF;">as</span><span style="color:#000000;"> DayCount
    </span><span style="color:#0000FF;">from</span><span style="color:#000000;"> (
        </span><span style="color:#0000FF;">select</span><span style="color:#000000;"> 
            </span><span style="color:#808080;">*</span><span style="color:#000000;">, 
            row_number() </span><span style="color:#0000FF;">over</span><span style="color:#000000;"> (partition </span><span style="color:#0000FF;">by</span><span style="color:#000000;"> PayrollNumber </span><span style="color:#0000FF;">order</span><span style="color:#000000;"> </span><span style="color:#0000FF;">by</span><span style="color:#000000;"> DateFrom) 
                </span><span style="color:#808080;">-</span><span style="color:#000000;"> </span><span style="color:#FF00FF;">cast</span><span style="color:#000000;">(DateFrom  </span><span style="color:#0000FF;">as</span><span style="color:#000000;"> </span><span style="color:#0000FF;">int</span><span style="color:#000000;">) </span><span style="color:#0000FF;">as</span><span style="color:#000000;"> ConsecutiveOffset
        </span><span style="color:#0000FF;">from</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;">
    ) x
    </span><span style="color:#0000FF;">group</span><span style="color:#000000;"> </span><span style="color:#0000FF;">by</span><span style="color:#000000;"> PayrollNumber, ConsecutiveOffset
    </span><span style="color:#0000FF;">order</span><span style="color:#000000;"> </span><span style="color:#0000FF;">by</span><span style="color:#000000;"> PayrollNumber, DateFrom
    </span>





This produces the following result set :




    
    <span style="color:#000000;">PayrollNumber DateFrom                DateTo                  DayCount
    </span><span style="color:#008080;">--</span><span style="color:#008080;">----------- ----------------------- ----------------------- -----------</span><span style="color:#008080;">
    </span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">02</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">08</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">02</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">12</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">5</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">03</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">03</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">17</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">4</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">03</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">18</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">03</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">19</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">07</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">3</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">06</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">09</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">5</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">06</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">10</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">11</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2</span>





Which is almost perfect. However, there is a slight complexity in the system I’m working on. Holidays are initially planned and appear in a different table. When the timesheet for today is generated the planned holiday will be copied to the timesheet where it can be altered if reality is slightly different. This means that when I generate a holiday report for the current holiday year I have to merge planned and actual records – the problem is actuals are booked as date ranges. However, the code above has a pleasant side effect and already merges single days appearing consecutively **before** a date range holiday. Since timesheets can never appear after planned holiday I don’t need to worry about merging single days that appear **after **a date range. For example, this sql :




    
    <span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-08</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-08</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-09</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-09</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-10</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-10</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-11</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-11</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-12</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-02-12</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-14</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-14</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#008080;">--</span><span style="color:#008080;"> Here's a date range that came from planned holidays and therefore should not be merged</span><span style="color:#008080;">
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-15</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-17</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">4.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-18</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-18</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-19</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-03-19</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-05</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-05</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-06</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-06</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-07</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-07</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#008080;">--</span><span style="color:#008080;"> Here's a date range that came from planned holidays and therefore should not be merged</span><span style="color:#008080;">
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-06-05</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-09</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">5.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-06-10</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-10</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span><span style="color:#0000FF;">insert</span><span style="color:#000000;"> </span><span style="color:#0000FF;">into</span><span style="color:#000000;"> </span><span style="color:#008000;">@Holidays</span><span style="color:#000000;"> </span><span style="color:#0000FF;">values</span><span style="color:#000000;">(</span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-06-11</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#FF0000;">'</span><span style="color:#FF0000;">2010-05-11</span><span style="color:#FF0000;">'</span><span style="color:#000000;">, </span><span style="color:#800000;font-weight:bold;">1.00</span><span style="color:#000000;">)
    </span>





produces this result :




    
    <span style="color:#000000;">PayrollNumber DateFrom                DateTo                  DayCount
    </span><span style="color:#008080;">--</span><span style="color:#008080;">----------- ----------------------- ----------------------- -----------</span><span style="color:#008080;">
    </span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">02</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">08</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">02</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">12</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">5</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">03</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">03</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">17</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">5</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">14</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">03</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">18</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">03</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">19</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">07</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">3</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">06</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">09</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">5</span><span style="color:#000000;">
    </span><span style="color:#800000;font-weight:bold;">15</span><span style="color:#000000;">            </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">06</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">10</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2010</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">05</span><span style="color:#808080;">-</span><span style="color:#800000;font-weight:bold;">11</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00</span><span style="color:#000000;">:</span><span style="color:#800000;font-weight:bold;">00.000</span><span style="color:#000000;"> </span><span style="color:#800000;font-weight:bold;">2</span><span style="color:#000000;">
    
    </span>





Where the date range 2010-03-15 to 2010-03-17 has been correctly merge with 2010-03-14 but not with 2010-03-18.
